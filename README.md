# <div align="center">Improving Anomaly Detection for Electric Vehicle Charging with Generative Adversarial Networks</div>

## Table of Contents

- [About](#about)
- [Structure](#structure)
- [Getting Started](#getting-started)
  - [Installation](#installation)
  - [Usage](#usage)
    - [`ROC_curve_ML_Based_IDS.py`](#roc_curve_ml_based_idspy)
    - [`ROC_curve_RetrainML_Based_IDS.py`](#roc_curve_retrainml_based_idspy)
    - [`T_SNE_data_distribution.py`](#t_sne_distribution_datapy)
   

## About

This repository provides the source code for the paper "Improving Anomaly Detection for Electric Vehicle Charging with Generative Adversarial Networks" which is currently under review.

In the paper, we propose a framework for adversarial attack generation for enhancement of learning-based Intrusion Detection System (IDS) in Electric Vehicle (EV) charging session data. Here, we provide the corresponding data sets and source code, which were used by the generator to synthesize attack data.
Specifically, we provide generators trained with different so-called blackbox IDSs (e.g. Local Outlier Factor, Random Forest, Multilayer Perceptron classifier and ensemble method) and sampling strategies (i.e. normal and attack).

The generated figures shall have small difference compared to the published paper, since we have the random source in our generator.

The data for this work is based on [EV Charging IDS Data Sets](https://code.fbi.h-da.de/seacop/ev-charging-ids-data-sets/).

## Folder Structure

```structure
├───configs
├───data
│   ├───acn_caltech
│   ├───acn_jpl
│   └───acn_office
├───datapreprocessing
│   ├───encoder
├───models
│   ├───generator
│   │   ├───acn_caltech
│   │   │   ├───attack
│   │   │   └───normal
│   │   ├───acn_jpl
│   │   │   ├───attack
│   │   │   └───normal
│   │   └───acn_office
│   │       ├───attack
│   │       └───normal
│   ├───ML_models
│   │   ├───acn_caltech
│   │   ├───acn_jpl
│   │   └───acn_office
│   └───regression_model
│       ├───acn_caltech
│       ├───acn_jpl
│       └───acn_office
├───results
├───src
└───tools
```

This source directories are as follows:

**Executable Files in `tools`:**

- **`ROC_curve_ML_Based_IDS.py`** - Generates ROC curves to compare model performance before and after applying generated adversarial charging session.
- **`ROC_curve_RetrainML_Based_IDS.py`** - Generates ROC curves to compare model performance before and after incorporating adversarial charging session data into retraining.
- **`T_SNE_data_distribution.py`** - Visualizes distribution charging sessions using t-distributed stochastic neighbor embedding (t-SNE). 

**Source Directories:**

- **configs** - Contains all configurations for parameters and links to model checkpoints and data.
- **data** - Contains all data files required for the implementation of the project.
- **datapreprocessing** - Contains datapreprocessing artifacts
    - **encoder** - Contains pickle files of encoder objects for generating the next charge speed prediction.
- **models** - Contains model checkpoints.
    - **generator** - Contains Generator checkpoints, which are responsible for generating adversarial charging sessions.
    - **ML_models** - Contains pickle files of learning-based IDS models, used for detecting anomalies, before and after retraining.
    - **regression_model** - Contains pickle files of the models used for predicting the next charge speed, and incorporates submodels in an ensemble method.
- **results** - Contains the output figures generated by scripts.
- **src** - Contains helper functions and model implementation.
- **tools** - Contains all needed scripts for visualization.

## Getting Started

### Installation
1. Clone project repo
    ```
    git clone https://github.com/UniCollabBGSV/GAN4EVCharging.git
    ```

2. Set up a virtual environment
    
    This project requires Anaconda for execution. If you do not have Anaconda installed, please download it from [here](https://docs.anaconda.com/anaconda/install/)
    
    Create a virtual environment name `lstmgan`

    ``` 
    conda create -n lstmgan python
    ```

    Activating the virtual environment

    ```
    conda activate lstmgan
    ```

    Install Pytorch (with CUDA support) 
    
     ```
    conda install pytorch torchvision torchaudio pytorch-cuda=12.1 -c pytorch -c nvidia
    ```
 
3. Install project dependencies

    ```
    cd .\GAN_IDS\  
    pip install -e .
    ```

### Usage

#### `ROC_curve_ML_Based_IDS.py`

To generates ROC curves before and after applying adversarial charging session.

```
python .\tools\ROC_curve_ML_Based_IDS.py acn_office attack -s -d
```

For more information:

```
python .\tools\ROC_curve_ML_Based_IDS.py -h
```

#### `ROC_curve_RetrainML_Based_IDS.py`

To generates ROC curves before and after retraining ML-Based IDS with adversarial charging session.

```
python .\tools\ROC_curve_RetrainML_Based_IDS.py acn_office attack -s -d
```

For more information:

```
python .\tools\ROC_curve_RetrainML_Based_IDS.py -h
```

#### `T_SNE_data_distribution.py`

To visualize distribution charging sessions using t-SNE, run the following command:

```
python .\tools\T_SNE_data_distribution.py acn_office attack -b -s -d
```

For more information:

```predict help
python .\tools\T_SNE_data_distribution.py -h
```
